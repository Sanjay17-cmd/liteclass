<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="icon-192.png">
  <meta charset="UTF-8">
  <title>Teacher Online</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- User Info + Logout -->
  <div id="user-info" class="user-info"></div>
  <button onclick="localStorage.removeItem('remoteclass_user'); window.location.href='index.html'">Logout</button>

  <h2>Teacher Dashboard</h2>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="polls">Polls</button>
    <button class="tab-btn" data-tab="classes">Classes</button>
    <button class="tab-btn" data-tab="recorder">Recorder</button>
    <button class="tab-btn" data-tab="prerecorded">Pre-recorded</button>
    <button class="tab-btn" data-tab="queue">Upload/Download Queue</button>
    <button class="tab-btn" data-tab="assignments">Assignments</button>
    <button class="tab-btn" data-tab="quizzes">Quizzes</button>
  </div>

  <!-- Classes tab (placeholder, never shown) -->
  <div id="tab-classes" class="tab-content hidden">
    <h3>Redirecting to Live Classes...</h3>
  </div>

  <!-- Recorder tab -->
  <div id="tab-recorder" class="tab-content hidden">
    <h3>Record a Live Class</h3>

    <label for="rec-teacher">Teacher Name:</label>
    <input type="text" id="rec-teacher" placeholder="Enter teacher name">

    <label for="rec-subject">Subject:</label>
    <input type="text" id="rec-subject" placeholder="Enter subject">

    <label for="rec-date">Date:</label>
    <input type="date" id="rec-date">

    <label for="rec-time">Time:</label>
    <input type="time" id="rec-time">

    <label for="rec-slides">Slides (multiple images):</label>
    <input type="file" id="rec-slides" accept="image/*" multiple>

    <div id="recorder-controls">
      <div id="rec-status" style="margin:10px 0; font-weight:bold; color:green;"></div>
      <button id="rec-toggle">Start</button>
      <button id="rec-stop" disabled>Stop</button>
    </div>

    <div id="rec-slides-container"></div>
    <button id="rec-prev-slide" disabled>Prev Slide</button>
    <button id="rec-next-slide" disabled>Next Slide</button>

    <button id="rec-save" disabled>Save Offline</button>
    <button id="rec-list">Show Saved Classes</button>
    <ul id="rec-saved-list"></ul>
  </div>

  <!-- Pre-recorded tab -->
  <div id="tab-prerecorded" class="tab-content hidden">
    <h3>Upload Pre-recorded</h3>

    <label for="pre-teacher">Teacher Name:</label>
    <input type="text" id="pre-teacher" placeholder="Enter teacher name">

    <label for="pre-subject">Subject:</label>
    <input type="text" id="pre-subject" placeholder="Enter subject">

    <label for="pre-date">Date:</label>
    <input type="date" id="pre-date">

    <label for="pre-time">Time:</label>
    <input type="time" id="pre-time">

    <label for="pre-audio">Audio File:</label>
    <input type="file" id="pre-audio" accept="audio/*">

    <label for="pre-slides">Slides (multiple images):</label>
    <input type="file" id="pre-slides" accept="image/*" multiple>

    <label for="pre-timeline">Slide Timeline</label>
    <textarea id="pre-timeline" placeholder="00:00 -> 1
00:10 -> 2
00:20 -> 3"></textarea>

    <button id="pre-save">Save Offline</button>
    <button id="pre-list">Show Saved Classes</button>
    <ul id="pre-saved-list"></ul>
    <div id="pre-status" style="margin:10px 0; font-weight:bold; color:green;"></div>
  </div>

  <!-- Queue tab -->
  <div id="tab-queue" class="tab-content hidden">
    <h3>Upload/Download Queue</h3>
    <ul id="queue-list"></ul>
  </div>

  <!-- Assignments tab -->
 <div id="tab-assignments" class="tab-content hidden">
  <h3>Assignments</h3>

  <label>Subject:</label>
  <input type="text" id="ass-subject" placeholder="Enter subject">

  <label>Instructions:</label>
  <textarea id="ass-instructions" placeholder="Enter assignment instructions"></textarea>

  <label>Assignment File:</label>
  <input type="file" id="ass-file">

  <button id="create-assignment">Post Assignment</button>

  <h4>Posted Assignments</h4>
  <ul id="assignment-list"></ul>
</div>

  <!-- Quizzes tab -->
  <div id="tab-quizzes" class="tab-content hidden">
    <h3>Quizzes</h3>
    <label>Subject:</label>
    <input type="text" id="quiz-subject" placeholder="Enter subject name">
    <div id="quiz-questions-container"></div>
    <button id="add-question">+ Add Question</button>
    <button id="save-quiz">Save Quiz</button>
    <h4>Existing Quizzes</h4>
    <button id="refresh-quizzes">Show Already Given Quizzes</button>
    <ul id="quiz-list"></ul>
  </div>

  <!-- Polls tab -->
  <div id="tab-polls" class="tab-content active">
    <h3>Polls</h3>
    <label>Poll Question:</label>
    <input type="text" id="poll-question" placeholder="Enter your poll question">
    <div id="poll-options">
      <input type="text" class="poll-option" placeholder="Option 1">
      <input type="text" class="poll-option" placeholder="Option 2">
    </div>
    <button id="add-option">+ Add Option</button>
    <button id="create-poll">Create Poll</button>
    <h4>Existing Polls</h4>
    <button id="refresh-polls">Show Previous Polls</button>
    <ul id="poll-list"></ul>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2.57.4/dist/umd/supabase.js"></script>
  <script src="supabase.js"></script>
  <script src="jszip.min.js"></script>
  <script src="teacher.js"></script>
  <script src="app.js"></script>

  <script>
    // ✅ Session check
    const user = JSON.parse(localStorage.getItem("remoteclass_user"));
    if (!user || user.role !== "teacher") {
      alert("❌ Only teachers can access this page!");
      window.location.href = "index.html";
    } else {
      document.getElementById("user-info").textContent =
        `👤 ${user.username} (${user.role}, ID: ${user.id})`;
    }

    // Open default tab if set
const defaultTeacherTab = localStorage.getItem("defaultTeacherTab");
if (defaultTeacherTab) {
  document.querySelector(`[data-tab="${defaultTeacherTab}"]`).click();
  localStorage.removeItem("defaultTeacherTab");
}

const defaultStudentTab = localStorage.getItem("defaultStudentTab");
if (defaultStudentTab) {
  document.querySelector(`[data-tab="${defaultStudentTab}"]`).click();
  localStorage.removeItem("defaultStudentTab");
}


    // ✅ Tab switching with Classes redirect
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        if (btn.dataset.tab === "classes") {
          window.location.href = "teacher-live.html";
          return;
        }
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
        btn.classList.add("active");
        const tabId = "tab-" + btn.dataset.tab;
        document.getElementById(tabId).classList.remove("hidden");
      });
    });
  </script>
</body>
</html>
