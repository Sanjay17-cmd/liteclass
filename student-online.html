<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="icon-192.png">
  <meta charset="UTF-8">
  <title>Student Online</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- User Info + Logout -->
  <div id="user-info" class="user-info"></div>
  <button onclick="localStorage.removeItem('remoteclass_user'); window.location.href='index.html'">Logout</button>

  <h2>Student Dashboard</h2>

  <!-- Tabs -->
<div class="tabs">
  <button class="tab-btn active" data-tab="polls">Polls</button>
  <button class="tab-btn" data-tab="classes">Classes</button>
  <button class="tab-btn" data-tab="prerecorded">Pre-recorded</button> 
  <button class="tab-btn" data-tab="queue">Download & Upload Queue</button>
  <button class="tab-btn" data-tab="assignments">Assignments</button>
  <button class="tab-btn" data-tab="quizzes">Quizzes</button>
</div>

  <!-- Classes tab -->
<div id="tab-classes" class="tab-content hidden">
  <h3>Redirecting to Live Classes...</h3>
</div>

  <!-- Pre-recorded tab -->
<div id="tab-prerecorded" class="tab-content hidden">
  <h3>Pre-recorded Classes</h3>

  <button id="show-cache">Show Saved Classes</button>
  <ul id="cache-list"></ul>

  <h3>Or Load From File</h3>
  <input type="file" id="load-zip" accept=".zip">

  <div id="class-info" class="hidden">
    <h3 id="class-subject"></h3>
    <p><strong>Teacher:</strong> <span id="class-teacher"></span></p>
    <p><strong>Date:</strong> <span id="class-date"></span></p>
    <p><strong>Time:</strong> <span id="class-time"></span></p>
  </div>

  <audio id="class-audio" controls></audio>
  <div id="slides-container"></div>

  <div class="controls">
    <button id="start-btn">Start</button>
    <button id="reset-btn">Reset</button>
    <button id="prev-slide">Prev Slide</button>
    <button id="next-slide">Next Slide</button>
    <button id="back-10">-10s</button>
    <button id="forward-10">+10s</button>
  </div>
</div>


  <!-- Assignments tab -->
  <div id="tab-assignments" class="tab-content hidden">
    <h3>Assignments</h3>
    <ul id="student-assignment-list"></ul>
  </div>

  <!-- Quizzes tab -->
  <div id="tab-quizzes" class="tab-content hidden">
    <h3>Quizzes</h3>
    <ul id="student-quiz-list"></ul>
  </div>

  <!-- Polls tab -->
  <div id="tab-polls" class="tab-content hidden">
    <h3>Polls</h3>
    <ul id="student-poll-list"></ul>
  </div>
  
  <!-- Download & Upload Queue tab -->
<div id="tab-queue" class="tab-content hidden">
  <h3>üì• Download & Upload Queue</h3>

  <h4>Available Teacher Uploads</h4>
  <ul id="teacher-upload-list"></ul>

  <h4>üì§ Assignment Upload</h4>
  <ul id="assignment-upload-list"></ul>

  <h4>‚¨áÔ∏è Downloaded Files</h4>
  <button id="toggle-downloaded">Show Downloaded Files</button>
  <ul id="downloaded-files" class="hidden"></ul>
</div>

  <script src="https://unpkg.com/@supabase/supabase-js@2.57.4/dist/umd/supabase.js"></script>
  <script src="supabase.js"></script>
  <script src="jszip.min.js"></script>
  <script src="student.js"></script>
  <script src="app.js"></script>

  <script>
    // ‚úÖ Session check
    const user = JSON.parse(localStorage.getItem("remoteclass_user"));
    if (!user || user.role !== "student") {
      alert("‚ùå Only students can access this page!");
      window.location.href = "index.html";
    } else {
      document.getElementById("user-info").textContent =
        `üë§ ${user.username} (${user.role}, ID: ${user.id})`;
    }

    // Open default tab if set
const defaultTeacherTab = localStorage.getItem("defaultTeacherTab");
if (defaultTeacherTab) {
  document.querySelector(`[data-tab="${defaultTeacherTab}"]`).click();
  localStorage.removeItem("defaultTeacherTab");
}

const defaultStudentTab = localStorage.getItem("defaultStudentTab");
if (defaultStudentTab) {
  document.querySelector(`[data-tab="${defaultStudentTab}"]`).click();
  localStorage.removeItem("defaultStudentTab");
}


// ‚úÖ Tab switching
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
  if (btn.dataset.tab === "classes") {
    window.location.href = "student-live.html";
    return; // stop here
  }

  document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
  btn.classList.add("active");
  const tabId = "tab-" + btn.dataset.tab;
  document.getElementById(tabId).classList.remove("hidden");

      // üîÑ Reload data when switching tabs
      if (tabId === "tab-assignments") loadStudentAssignments();
      if (tabId === "tab-quizzes") loadStudentQuizzes();
      if (tabId === "tab-polls") loadStudentPolls();
      if (tabId === "tab-prerecorded") {
        // optional: auto-show cache list for prerec
        document.getElementById("cache-list").innerHTML = "";
      }
    });
  });
});


  </script>
</body>
</html>
